

    #<langs main="russian">
      #english
      #russian
    #</langs>

tex_exe: pdflatex

vars:
  pagestyle: fancy
  ii_base:
  - body 
  - preamble 
  - index 
  - bib
  - titlepage
  - defs
  - listfigs 
  - listtabs
  - tabcont
  - preamble.index 
  - preamble.packages 
  - preamble.acrobat_menu 
  - preamble.filecontents

decs:
- do_ind_titletoc

###opts_maker
opts_maker:
  skip:
    get_opt: 1
# Plg::Projs::Build::Maker::Join _join_lines
  join_lines:
    include_below: 'section'
  load_dat:
    ii_exclude : 1
    ii_include : 0

  sections :
# Plg::Projs::Build::Maker   init_ii_include
#                            ii_filter
    include: '_base_'
    include_with_children : 'preamble'
    ins_order:
    - hyperlinks
    - titletoc
    - story
    append:
      only:
      each:
    prepend:
      only:
        '_main_' :
        - '\newif\ifDEBUG\DEBUGfalse'
        - ''
        - '\newif\ifcmt\cmtfalse'

# _join_lines                  Plg::Projs::Build::Maker::Join
#   _gen_sec                   Plg::Projs::Prj::Builder::Gen
#     _sct_lines               Plg::Projs::Prj::Builder::Sct - match @printindex
#      _bld_ind_printindex         same
#         _bld_ind_lines           same
#            _bld_ind         =>  /preamble/index/ind values

###preamble
preamble:
  index:
    enable :
       - authors.rus
       #- names.rus
       #- rus
    ind:
       - name: ''
         title: ''
       - name: 'rus'
         title: 'Предметный указатель'
       - name: 'authors.rus'
         title: 'Авторы'
       - name: 'names.rus'
         title: 'Имена'
       - name: 'cities.rus'
         title: 'Города'
       - name: 'deaths.rus'
         title: 'Смерти'
       - name: 'writers.rus'
         title: '{Писатели, Поэты, Мыслители}'
       - name: 'eng'
         title: 'Index'

sii:
  insert:
    hyperlinks: 0
    story: 1
    titletoc: 1

  generate:
###generate
    'on':
    - '_main_'
    - index
    - tabcont
    - listfigs
    - listtabs
    - preamble
    - preamble.packages
    - preamble.index
    - preamble.filecontents


# Plg::Projs::Prj::Builder::Sct
  scts:
###sct_preamble
    preamble:
      contents: '@doc @ii @setcounter @perl'
      doc:
        class: extreport
        opts: 'a4paper,11pt'
      ii:
      - preamble.packages
      - preamble.index
      #- preamble.acrobat_menu
      - preamble.filecontents
      perl: "'\\relax';"
      setcounter:
        secnumdepth: 0

###sct_listfigs
    listfigs:
       contents:
       - '\IfFileExists{./lst_figs.tex}{%'
       - ' @txt.lof'
       - '}{}'
       txt:
         lof:
         - '\cleardoublepage'
         - '\phantomsection'
         - '\addcontentsline{toc}{chapter}{\listfigurename}'
         - '\listoffigures'

###sct_listtabs
    listtabs:
       contents:
       - '\IfFileExists{./lst_tabs.tex}{%'
       - ' @txt.lot'
       - '}{}'
       txt:
         lot:
         - '\cleardoublepage'
         - '\phantomsection'
         - '\addcontentsline{toc}{chapter}{\listtablename}'
         - '\listoftables'

###sct_tabcont
    tabcont:
       contents:
       - '\cleardoublepage'
       - '\phantomsection'
       - '\addcontentsline{toc}{chapter}{\contentsname}'
       - '\hypertarget{tabcont}{}'
       - '\tableofcontents'
       - '%\setcounter{tocdepth}{1}'
       - '\addtocontents{toc}{\setcounter{tocdepth}{1}}'
       - '\newpage'

###sct_preamble.index
    'preamble.index':
       contents: '@makeindex'

###sct_index
    'index':
       contents:
       - '\IfFileExists{./print_index.tex}{%'
       - ' @txt.hdr'
       - ' @txt.ptc.start'
       - ' @printindex'
       - ' @txt.ptc.stop'
       - '}{}'
       txt:
         hdr:
         - '\clearpage'
         - '\phantomsection'
         - '\begin{center}'
         - '  {\Huge\bfseries \indicesname}\par'
         - '  \hyperlink{tabcont}{\contentsname}'
         - '\end{center}'
         - '\addcontentsline{toc}{part}{Указатели}'
         - '\hypertarget{indices}{}'
         ptc:
           start:
           - '@ifdec{do_ind_titletoc}'
           - '  \startcontents[indices]'
           - '  \printcontents[indices]{l}{1}{\addtocontents{ptc}{\setcounter{tocdepth}{1}}}'
           - '@fi'
           stop:
           - '@ifdec{do_ind_titletoc}'
           - '  \stopcontents[indices]'
           - '@fi'

###sct_preamble.filecontents
    'preamble.filecontents':
       contents: '@input'
       input:
       - 'src.preamble.filecontents.xdy'
       - 'src.preamble.filecontents.index_eng_xdy'
       - 'src.preamble.filecontents.index_rus_xdy'

###sct_preamble.packages
    'preamble.packages':
       contents: '@pkg @ii'
       ii:
       pkg:
         'pack_list':
         - titletoc
         - xparse
         - p.core
         - p.wrapfig
         - p.fancyquote
        #- p.shadequote
         - p.env
         - p.rus
         - p.secs
         - p.toc
         - p.fb
         - p.sechyperlinks
         - imakeidx
         - p.hyperref
         - geometry
         - ''
         - 'color xcolor colortbl'
         - ''
         - graphicx
         - tikz
         - tikzsymbols
         - pgffor
         - ''
         - adjustbox
         - longtable
         - multicol
         - filecontents
         - datetime2
         - mathtext
         - nameref
         - p.fancyhdr
         - p.fig.caption
         'pack_opts':
           adjustbox: export
           datetime2: useregional
           geometry:
           - 'hmargin={1cm,1cm}'
           - 'vmargin={2cm,2cm}'
           - 'centering'
           hyperref:
           - 'colorlinks=true'
           - 'linktoc=all'
           - 'linkcolor=blue'
           - 'letterpaper'
           - 'unicode'
           - 'linktocpage'
           - 'bookmarksdepth=subparagraph'
           - 'bookmarksnumbered=true'
           imakeidx: xindy
           tocloft: titles

###sct__main_
    '_main_':
      #contents: '@doc @ii @setcounter @perl'
      contents:
      - '@txt.cmt.head'
      - '@txt.if @txt.proj'
      - '@ii.prm'
      - '\begin{document}'
      - '@ii.inner.start'
      - '@ii.inner.body'
      - '@ii.inner.end'
      - '\end{document}'
      ii:
        prm:
          - preamble
          - defs
        inner:
          start:
          #- titlepage
          - listfigs
          - listtabs
          - tabcont
          body:
          - body
          end:
          - index
          #- bib
      txt:
        cmt:
          head:
          - '% generated by Gen.pm'
        if:
        - '\newif\ifDEBUG'
        - '\DEBUGfalse'
        - ' '
        - '\newif\ifINDEX'
        - '\INDEXtrue'
        - ' '
        - '\newif\ifcmt'
        - '\cmtfalse'
        proj:
        - '\def\PROJ{@@proj}'
        - '\def\ii#1{\InputIfFileExists{\PROJ.#1.tex}{}{}}'
        - ''
